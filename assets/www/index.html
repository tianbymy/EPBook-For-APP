<!DOCTYPE html>
<html lang="en">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <title>企业通讯录</title>
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <!-- stylesheet lib begin -->
    <link href="css/jquery.mobile.css" rel="stylesheet" type="text/css" />
    <link href="css/jqm-icon-pack-fa.css" rel="stylesheet" type="text/css" />
    <link href="css/public.css" rel="stylesheet" type="text/css" />
    <!-- stylesheet lib end -->
    <!-- stylesheet lib begin-->

    <script src="javascript/jquery.js" type="text/javascript"></script>
    <script src="javascript/jquery.mobile.js" type="text/javascript"></script>

    <!-- stylesheet lib end-->

    <!-- zhiyisoft custom-theme -->
    <link href="css/public.css" rel="stylesheet" type="text/css" />
    <script src="javascript/application.js" type="text/javascript"></script>
    <!-- zhiyisoft custom-theme -->
  </head>
  <body>
    <div id="page" data-role="page">
      <div data-role="header" data-theme="a">
	<h1>企业通讯录</h1>
      </div>
      <div data-role="content">
	<form method="post" id="loginform">
	  <div data-role="controlgroup">
	    <input id="account" type="text" id="account" name="account" value="tianbymy@163.com"/>
	    <input type="password" id="password" name="password" value="adminxg" />
	  </div>
	  <fieldset class="ui-grid-a">
	    <div class="ui-block-a"><button type="submit" data-theme="c">注册</button></div>
	    <div class="ui-block-b"><a data-role="button" onclick="submit_login()" id="submit" data-theme="e">登录</a></div>
	  </fieldset>
	  <a href="#">忘记密码</a>
	</form>
      </div>

      <div data-role="footer" data-position="fixed">
	<p  data-inline="true">&copy;2013 ZhiyiSoft, Inc.</p>
      </div>
    </div>

    <script type="text/javascript">
    	$(function() {
	    //输入事件
	    $("input[id]").bind("focus",function () {
		if($(this).attr("id")=='account'||$(this).attr("id")=='password')
		    $(this).attr("value","");
	    });
	})
	    //提交
	    function submit_login() {
		if (valid()) {
		    alert("正在请求登录...")
		    $.ajax({
			type: "POST",
			url: login_path,
			data: $("form#loginform").serialize(),
			dataType: "jsonp",
			jsonp: "callback",
			success: function(msg){
			    if(msg.status=="success"){
				/*初始化user*/
				inituser(msg.email,msg.auth_token);
				$.mobile.changePage("dashboard.html","slidedown", false, false);
			    }else{
				$("$message").html("登录失败,请重新登录");
				$.mobile.changePage("index.html","slidedown", false, false);
			    }

			}
		    });
		}
	    }
	//输入信息验证
	function valid(){
	    if($("#account").val()==''||$("#password").val()=='')
	    {
		alert("信息验证失败")
		$.mobile.changePage("index.html","slidedown", true, true);
		return false;
	    }
	    return true;
	};
      </script>
  </body>
</html>
