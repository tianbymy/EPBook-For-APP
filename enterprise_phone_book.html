<!DOCTYPE html>
<html class="ui-mobile" lang="en">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>企业电话簿</title>

    <link href="css/jquery.mobile.css"  rel="stylesheet" type="text/css" />
    <link href="css/jquery-ui.css"  rel="stylesheet" type="text/css" />
    <link href="css/zhiyi-custom-theme.css"  rel="stylesheet" type="text/css" />
    <link href="css/public.css" rel="stylesheet" type="text/css" />

    <script src="javascript/jquery.js" type="text/javascript"></script>
    <script src="javascript/jquery_ujs.js" type="text/javascript"></script>
    <script src="javascript/jquery.mobile.js" type="text/javascript"></script>
    <script src="javascript/public.js" type="text/javascript"></script>


  </head>
  <body id="body">
    <div data-role="page" id="body">
      <div class="navbar" data-role="header">
	<a href="#" data-rel="back" >后退</a>
	<h2></h2>
      	<a href="#" id="logout" data-role="button" data-icon="delete">退出</a>
	<script type="text/javascript">
    	  $(function(){
	      $("#logout").bind("click",function(){
		  logout();
	      })
	      welcome();
	  })
	</script>
      </div>
      <div data-role="content" id="working-area">
	<div id="user"></div>
	<!-- 企业电话簿  区域-->
	<div id="data-list"></div>
      </div>
    </div>
  </body>


  <script type="text/javascript">
    /*初始化user*/

    $(function(){
	organ_id = localStorage.getItem('organ_id');
	if(organ_id==null){
	    $("#data-list").html("<span style='color:red'>尊敬的用户您好，您暂时尚未加入任何企业，您需要先申请加入企业才能查看详细。</span>")
	}else{
	    get_servers({
		url: get_root_organ_path,
		data: {"organ_id": organ_id},
		callback: function(data){
		    $("#body h2").html(data.name)
		    list_children("#body #data-list",data.id)
		}
	    })
	}
    })

    function get_children(organ_id){

    }
    function get_users(organ_id){

    }
    function list_children(dom,organ_id){
	get_servers({
	    url: get_childs_organ_path,
	    data: {"organ_id": organ_id},
	    callback: function(result){
		html="";
		html+="<div>部门总数<span class='ui-li-count'>"+result.length+"</span></div>"
		for (i in result){
		    html+="<ul>";
		    if (result.child){
			html+="<li data-role='collapsible'>";
		    }else{
			html+="<li data-role='collapsible'>";
		    }
		    html+=result[i].name
		    html+="</li>";
		    html+="</ul>";
		}
		$(dom).append(html)
	    }
	})
    }
  </script>
</html>












