<!DOCTYPE html>
<html class="ui-mobile" lang="en">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>企业电话簿</title>

    <link href="css/jquery.mobile.css"  rel="stylesheet" type="text/css" />
    <link href="css/jquery-ui.css"  rel="stylesheet" type="text/css" />
    <link href="css/zhiyi-custom-theme.css"  rel="stylesheet" type="text/css" />
    <link href="css/public.css" rel="stylesheet" type="text/css" />

    <script src="javascript/jquery.js" type="text/javascript"></script>
    <script src="javascript/jquery_ujs.js" type="text/javascript"></script>
    <script src="javascript/jquery.mobile.js" type="text/javascript"></script>
    <script src="javascript/public.js" type="text/javascript"></script>
  </head>
  <body id="body">
    <div data-role="page" id="body">
      <div class="navbar" data-role="header">
	<h2>企业通讯录</h2>
      </div>
      <div data-role="content" id="working-area">
	<div id="message"></div>
	<form method="post" id="loginform">
      	  <input type="text" id="account" name="user_login[email]" value="tianbymy@163.com"/><br />
      	  <input type="password" id="passwrd" name="user_login[password]" value="adminxg"/>
	  <a data-role="button" id="submit" data-theme="e">登录</a>
          <a href="#">注册</a> | <a href="#">忘记密码</a>
	</form>
      </div>
      <script type="text/javascript">
    	$(function() {
	    //输入事件
	    $("input[id]").bind("focus",function () {
		if($(this).attr("id")=='account'||$(this).attr("id")=='password')
		    $(this).attr("value","");
	    });
	    //提交
	    $("#submit").bind("click", function() {
		if (valid()) {
		    $.ajax({
			type: "POST",
			url: login_path,
			data: $("form#loginform").serialize(),
			dataType: "jsonp",
			jsonp: "callback",
			success: function(msg){
			    if(msg.status=="success"){
				localStorage.setItem('email', msg.email);
				localStorage.setItem('token', msg.auth_token);
				$.mobile.changePage("dashboard.html","slidedown", true, true);
			    }else{
				$("$message").html("登录失败,请重新登录");
				$.mobile.changePage("index.html","slidedown", true, true);
			    }

			}
		    });
		}
	    });
	});
	//输入信息验证
	function valid(){
	    if($("#username").attr("value")==''||$("#password").attr("value")=='')
	    {
		$.mobile.changePage("index.html","slidedown", true, true);
		return false;
	    }
	    return true;
	};
      </script>



  </body>
</html>
